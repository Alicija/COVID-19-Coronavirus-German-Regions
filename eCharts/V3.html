<!DOCTYPE html>
<html style="height: 100%">

<head>
    <title>Testing eCharts - V3</title>
    <meta charset="utf-8">
</head>

<body style="height: 100%; margin: 0">
    <div id="container" style="height: 100%"></div>
    <script src="lib/echarts-en.min.js"></script>
    <script type="text/javascript" src="lib/jquery-3.5.0.min.js"></script>
    <!--  -->
    <!-- <script scr="lib/V1.js"></script> -->
    <script type="text/javascript">

        console.log('Start');


        // TODO: 
        // function fetchall() {
        //     fetch('DE');
        //     fetch('HU');
        // }
        // function fetch(country_code) {
        // var url_json_data_DE = 'https://entorb.net/COVID-19-coronavirus/data/int/country-' + country_code + '.json';
        var url_json_data_DE = 'https://entorb.net/COVID-19-coronavirus/data/int/country-DE.json';
        var myDataDE = [];
        // Attention: getJSON is async!!!
        var jqxhrDE = $.getJSON(url_json_data_DE, function (data) {
            console.log("success");
        })
            .done(function (data) {
                console.log("done");
                $.each(data, function (key, val) {
                    myDataDE.push([data[key].Days_Past, data[key].Cases]);
                });
                return myDataDE;
            })
            .fail(function () {
                console.log("fail");
            })
        // .always(function () {
        //     console.log("always");
        // });
        // }
        // var myData1 = fetch('DE');


        var url_json_data_HU = 'https://entorb.net/COVID-19-coronavirus/data/int/country-HU.json';
        var myDataHU = [];
        var jqxhrHU = $.getJSON(url_json_data_HU, function (data) {
            console.log("success");
        })
            .done(function (data) {
                console.log("done");
                $.each(data, function (key, val) {
                    myDataHU.push([data[key].Days_Past, data[key].Cases]);
                });
                return myDataHU;
            })
            .fail(function () {
                console.log("fail");
            })



        var dom = document.getElementById("container");
        var myChart = echarts.init(dom);
        var app = {};
        option = null;
        option = {
            xAxis: {},
            yAxis: {},
            series: [
                {
                    // symbolSize: 20,
                    // data: myData1,
                    data: myDataDE,
                    name: 'DE',
                    type: 'scatter'
                    // type: 'line'
                }
                ,
                {
                    // symbolSize: 20,
                    // data: myData1,
                    data: myDataHU,
                    name: 'HU',
                    type: 'scatter'
                    // type: 'line'
                }
            ],
            //tooltip.show = true
        };
        ;

        // TODO: How to chain several thens?
        // wait for async jquery call to finish
        jqxhrDE.then(function () {
            jqxhrHU.then(function () {
                if (option && typeof option === "object") {
                    myChart.setOption(option, true);
                }
            })
        }
        )

    </script>
</body>

</html>